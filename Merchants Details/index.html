<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Merchant Details</title>
    <style> 
        body {
          font-family: Arial, sans-serif;
          background-color: #f2f2f2;
          padding: 30px;
        }
      
        h2 {
          text-align: center;
          color: #007bff;
        }
      
        .brandSearchBox {
          max-width: 400px;
          margin: auto;
          position: relative;
        }
      
        #brandSearchInput {
          width: 100%;
          padding: 12px;
          font-size: 16px;
          border: 1px solid #ccc;
          border-radius: 5px;
          padding: 10px 10px 10px 40px; /* space for image */
          background-image: url('https://cdn-icons-gif.flaticon.com/14164/14164949.gif');
          background-repeat: no-repeat;
    background-position: 10px center;
    background-size: 20px 20px;

        }
      
        .brandSuggestions {
          position: absolute;
          background: white;
          width: 100%;
          max-height: 200px;
          overflow-y: auto;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          z-index: 100;
        }
      
        .brandSuggestionItem {
          padding: 10px;
          border-bottom: 1px solid #eee;
          cursor: pointer;
        }
      
        .brandSuggestionItem:hover {
          background: #007bff;
          color: white;
        }
      
        /* Container for brand cards in grid layout */
        .brandCardList {
          display: grid;
          grid-template-columns: repeat(4, minmax(250px, 1fr));
          gap: 20px;
          margin-top: 30px;
        }
      
        .brandCard {
          background: white;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        }
      
        .brandCard h3 {
          color: #007bff;
          margin-bottom: 10px;
        }
      
        .brandCard p {
          margin: 5px 0;
          font-size: 14px;
        }
      
        .brandImages {
          margin-top: 10px;
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
        }
      
        .brandImages img {
          width: 100%;
          max-width: 100px;
          border-radius: 8px;
          box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
        }
      
        /* Optional: Make search bar stick to top */
        .sticky-search {
          position: sticky;
          top: 0;
          background: #f2f2f2;
          z-index: 50;
          padding-bottom: 10px;
        }


        h2 {
    text-align: center;
    margin-top: 40px;
    margin-bottom: 20px;
    color: #007bff;
    font-size: 24px;
  }

  /* Business search input */
  #searchInput {
    display: block;
    width: 100%;
    max-width: 400px;
    margin: 0 auto 20px auto;
    padding: 12px 15px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 8px;
    transition: all 0.3s ease;
     padding: 10px 10px 10px 40px; /* space for image */
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 8px;
    background-image: url('https://cdn-icons-gif.flaticon.com/14164/14164949.gif');
    background-repeat: no-repeat;
    background-position: 10px center;
    background-size: 20px 20px;
  
  }

  #searchInput:focus {
    border-color: #007bff;
    box-shadow: 0 0 8px rgba(0, 123, 255, 0.2);
    outline: none;
  }

  /* Dropdown suggestion list */
  .merchant-list {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 400px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    z-index: 1000;
    max-height: 250px;
    overflow-y: auto;
  }

  .merchant-list div {
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    transition: background 0.2s;
  }

  .merchant-list div:hover {
    background-color: #007bff;
    color: white;
  }

  /* Card layout for details */
  .card {
    background: white;
    margin: 20px auto;
    padding: 20px;
    border-radius: 10px;
    max-width: 800px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .card h3 {
    color: #007bff;
    margin-bottom: 15px;
  }

  .card p {
    margin-bottom: 10px;
    color: #444;
    line-height: 1.5;
  }

  .card a {
    color: #007bff;
    text-decoration: none;
  }

  .card a:hover {
    text-decoration: underline;
  }

  .loader {
  text-align: center;
  margin-top: 20px;
  color: #333;
  font-size: 18px;
}

.spinner {
  display: inline-block;
  width: 30px;
  height: 30px;
  border: 3px solid #ccc;
  border-top: 3px solid #007bff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 10px;
}
.maindiv {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 40px;
    padding: 20px;
    flex-wrap: wrap;
  }

  .maindiv > div {
    flex: 1 1 45%;
    max-width: 600px;
  }

  .card {
    background-color: #fff;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  @media (max-width: 768px) {
    .maindiv > div {
      flex: 1 1 100%;
      max-width: 100%;
    }
  }

@keyframes spin {
  to { transform: rotate(360deg); }
}

#offersDetails {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    padding: 20px;
    width: 98%;
  }
  #offersDetails>div{
    box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
    border-radius: 5px;
    padding: 20px;
  }

  .offer-card {
    background-color: #fff;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  @media (max-width: 1024px) {
    #offersDetails {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 600px) {
    #offersDetails {
      grid-template-columns: 1fr;
    }
  }
#offerdiv{
    background-color: #fff;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}
      </style>
</head>

<body>
    <h2>Search Business</h2>
    <div class="input-wrapper">
        <input type="text" id="searchInput" placeholder="Search Business Name..." />
      </div>    
    <div id="merchantList" class="merchant-list"></div>
    <div class="maindiv">

    <div>
        <h2>Onboarded Data</h2>
        <div id="merchantDetails" class="card"></div>
    </div>
    
    <div>
        <h2>Merchant Marketing Data</h2>
        <div id="marketingDetails" class="card"></div>
    </div>
</div>

    <div id="offerdiv">
        <h2>Offers Data</h2>
            <div id="offersDetails" ></div>
    </div>

    <h2>Search Brand For Products Data</h2>
    

    <div class="brandSearchBox">
        <input type="text" id="brandSearchInput" placeholder="Type brand name..." />
        <!-- <div id="loader" class="loader">
            <span class="spinner"></span>
            <p>Loading Data...</p>
          </div> -->
        <div id="brandSuggestions" class="brandSuggestions"></div>
      </div>
      
      <div id="brandResultList" class="brandCardList"></div>

    <script>

const apiUrl = 'https://jbyy0iih41.execute-api.ap-south-1.amazonaws.com/prod/api/catalouge/catalogue-products';
    let allProducts = [];

    fetch(apiUrl)
      .then(res => res.json())
      .then(data => {
        allProducts = data.products.data || [];
        console.log('Fetched products:', allProducts);
      })
      .catch(err => console.error('API Error:', err));

    const input = document.getElementById('brandSearchInput');
    const suggestionBox = document.getElementById('brandSuggestions');
    const resultList = document.getElementById('brandResultList');

    input.addEventListener('input', () => {
      const value = input.value.toLowerCase().trim();
      suggestionBox.innerHTML = '';
      resultList.innerHTML = '';

      if (value.length === 0) {
        suggestionBox.style.display = 'none';
        return;
      }

      const uniqueBrands = [...new Set(allProducts.map(p => p.brandName).filter(Boolean))];
      const filteredBrands = uniqueBrands.filter(b => b.toLowerCase().includes(value));

      if (filteredBrands.length === 0) {
        suggestionBox.style.display = 'none';
        return;
      }

      suggestionBox.style.display = 'block';

      filteredBrands.forEach(brand => {
        const div = document.createElement('div');
        div.className = 'brandSuggestionItem';
        div.textContent = brand;
        div.addEventListener('click', () => {
          input.value = brand;
          suggestionBox.innerHTML = '';
          suggestionBox.style.display = 'none';
          showAllBrandEntries(brand);
        });
        suggestionBox.appendChild(div);
      });
    });

    function showAllBrandEntries(brandName) {
      resultList.innerHTML = '';
      const entries = allProducts.filter(p => p.brandName === brandName);
      if (entries.length === 0) {
        resultList.innerHTML = '<li>No products found for this brand.</li>';
        return;
      }

      entries.forEach(entry => {
        const li = document.createElement('li');
        li.textContent = `${entry.productName || 'Unnamed Product'} (${entry.brandName})`;
        resultList.appendChild(li);
      });
    }

function showAllBrandEntries(brandName) {
  const matchedItems = allProducts.filter(item => item.brandName === brandName);
  resultList.innerHTML = '';

  if (matchedItems.length === 0) {
    resultList.innerHTML = `<p>No entries found for "${brandName}"</p>`;
    return;
  }

  matchedItems.forEach(item => {
    const card = document.createElement('div');
    card.className = 'brandCard';

    card.innerHTML = `
      <h2>${item.brandName}</h2>
      <p><strong>Type:</strong> ${item.type}</p>
      <p><strong>Available Area:</strong> ${item.availArea?.join(', ') || 'N/A'}</p>
      <p><strong>Available City:</strong> ${item.availCity?.join(', ') || 'N/A'}</p>
      <p><strong>Created At:</strong> ${item.createdAt}</p>
      <p><strong>Category:</strong> ${item.category}</p>
      <p><strong>Subcategory:</strong> ${item.subCategory}</p>
      <p><strong>Title:</strong> ${item.title}</p>
      <p><strong>Sample Quantity:</strong> ${item.sampleAvailQuantity}</p>
      <p><strong>Credit Price:</strong> ₹${item.CreditPrice}</p>
      <p><strong>Final Price:</strong> ₹${item.FinalPrice}</p>
      <p><strong>Discount:</strong> ${item.DiscountPercentage}%</p>
      <p><strong>Description:</strong> ${item.description || ''}</p>
      <p><strong>Excerpt:</strong> ${item.Excerpt}</p>
      <div class="brandImages">
        ${item.ThumbnailImages?.map(img => `<img src="${img}" alt="thumb">`).join('') || ''}
        ${item.AssetImages?.map(img => `<img src="${img}" alt="asset">`).join('') || ''}
      </div>
    `;

    resultList.appendChild(card);
  });
}



        document.addEventListener("DOMContentLoaded", () => {
            const searchInput = document.getElementById("searchInput");
            const merchantList = document.getElementById("merchantList");
            const merchantDetails = document.getElementById("merchantDetails");
            const marketingDetails = document.getElementById("marketingDetails");
            const offersDetails = document.getElementById("offersDetails");
            let merchants = [];

            // Fetch merchants
            fetch("https://fieldteam.localite.services/api/getmerchants")
                .then(response => response.json())
                .then(data => { merchants = data.merchants; })
                .catch(error => console.error("Error fetching merchants:", error));

            // Display top 5 matching merchants
            function displayMerchants(filteredMerchants) {
                merchantList.innerHTML = "";
                merchantList.style.display = filteredMerchants.length > 0 ? "block" : "none";
                filteredMerchants.slice(0, 5).forEach(merchant => {
                    const div = document.createElement("div");
                    div.className = "merchant-item";
                    div.textContent = merchant.businessName;
                    div.onclick = () => {
                        searchInput.value = merchant.businessName;
                        showDetails(merchant);
                        merchantList.style.display = "none"; // Hide list after selection
                    };
                    merchantList.appendChild(div);
                });
            }

            // Show merchant details and fetch marketing & offer data
            function showDetails(merchant) {
                merchantDetails.innerHTML = `
                    <h3>${merchant.businessName}</h3>
                    <p><strong>Owner:</strong> ${merchant.personName} ${merchant.lastName}</p>
                    <p><strong>Business Type:</strong> ${merchant.businessType}</p>
                    <p><strong>Address:</strong> ${merchant.businessAddress}</p>
                    <p><strong>Years in Business:</strong> ${merchant.yearsOfBusiness}</p>
                    <p><strong>Employees:</strong> ${merchant.numberOfEmployees}</p>
                    <p><strong>Category:</strong> ${merchant.preferredCategories}</p>
                    <p><strong>Offer:</strong> ${merchant.offerFrequency}</p>
                    <p><strong>Email:</strong> ${merchant.contactEmail}</p>
                    <p><strong>Phone:</strong> ${merchant.contactPhoneNumber}</p>
                    ${merchant.profileImage ? `<img src="https://fieldteam.localite.services/api${merchant.profileImage}" width="150">` : ""}
                `;
                fetchMarketingData(merchant.mainid);
                fetchOffersData(merchant.mainid);
            }

            // Fetch & show marketing details
            function fetchMarketingData(mainid) {
                fetch(`https://fieldteam.localite.services/api/getmarketingdata/${mainid}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success && data.data) {
                            const m = data.data;
                            marketingDetails.innerHTML = `
        <h3>Marketing & Online Presence</h3>
        <p><strong>Business Name:</strong> ${m.businessName}</p>
        
        <p><strong>Google Maps:</strong> <a href="${m.googleMapLink}" target="_blank">View Location</a></p>
        <p><strong>Google Review Score:</strong> ${m.googleReviewScore}</p>
        <p><strong>Instagram:</strong> <a href="${m.instaPageLink}" target="_blank">Visit Instagram</a> | ${m.instaFollowers} followers | ${m.instaPosts} posts</p>
        <p><strong>Instagram Score:</strong> ${m.instaScore}</p>
        <p><strong>YouTube:</strong> <a href="${m.youtubePageLink}" target="_blank">Visit Channel</a> | ${m.youtubeVideos} videos | ${m.youtubeViews} views</p>
        <p><strong>WhatsApp Business:</strong> ${m.whatsappBusiness}</p>
        <p><strong>WhatsApp Store:</strong> ${m.whatsappStore}</p>
        <p><strong>WhatsApp Group:</strong> ${m.whatsappGroup}</p>
        <p><strong>Any Pamphlet:</strong> ${m.anyPamplate}</p>
        <div class="images-container">
            ${m.shopImage1 ? `<img src="https://fieldteam.localite.services/api${m.shopImage1}" width="150" alt="Shop Image">` : ""}
            ${m.shopImage2 ? `<img src="https://fieldteam.localite.services/api${m.shopImage2}" width="150" alt="Shop Image">` : ""}
            ${m.shopImage3 ? `<img src="https://fieldteam.localite.services/api${m.shopImage3}" width="150" alt="Shop Image">` : ""}
        </div>
    `;
                        } else {
                            marketingDetails.innerHTML = `<p>No marketing data available.</p>`;
                        }
                    })
                    .catch(error => console.error("Error fetching marketing data:", error));
            }

            function fetchOffersData(mainid) {
    fetch(`https://fieldteam.localite.services/api/getOfferDataByMainId/${mainid}`)
        .then(response => response.json())
        .then(data => {
            // Clear old data first
            offersDetails.innerHTML = "";

            if (data.length > 0) {
                data.forEach(offer => {
                    offersDetails.innerHTML += `
                        <div class="offer-card">
                            <p><strong>${offer.title}</strong></p>
                            <p><strong>Headline:</strong> ${offer.headline}</p>
                            <p><strong>Price:</strong> ${offer.price}</p>
                            <p><strong>Discount:</strong> ${offer.discountedPercentage}%</p>
                            <p><strong>Area:</strong> ${offer.area}, ${offer.city}</p>
                            <div class="images-container">
                                ${offer.image1 ? `<img src="https://fieldteam.localite.services/api/${offer.image1}" width="250" alt="Offer Image">` : ""}
                            </div>
                        </div>
                    `;
                });
            } else {
                offersDetails.innerHTML = "<h3>No offers available</h3>";
            }
        })
        .catch(error => console.error("Error fetching offers data:", error));
}


            searchInput.addEventListener("input", () => {
                const query = searchInput.value.toLowerCase();
                if (query.length > 0) {
                    const filtered = merchants.filter(merchant =>
                        merchant.businessName.toLowerCase().includes(query)
                    );
                    displayMerchants(filtered);
                } else {
                    merchantList.style.display = "none";
                }
            });
        });



    </script>

</body>

</html>